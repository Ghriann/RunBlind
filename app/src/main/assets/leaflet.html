<!DOCTYPE html>
<html>
    <head>
        <title>GIS</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <link rel="stylesheet" href="leaflet.css" />
        <style>
            html, body, #map {
                height: 100%;
                width: 100%
            }
            body {
                padding: 0;
                margin: 0;
            }
      </style>
    </head>
<body>
    <div id="map"></div>
</body>

<script src="leaflet.js"></script>
<script>

    var pathLine = null;
    var positionMarker = null;
    var isInteracting = false;
    var waitBeforeFit = false;

    var myIcon = L.icon({
        iconUrl: "marker.png",
        iconAnchor: [12,28]
    });

    var map = L.map('map').setView([48.712676, 2.220417], 17);

    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
        attribution: 'Data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
        maxZoom: 21,
        id: 'mapbox/streets-v11',
        tileSize: 512,
        zoomOffset: -1,
        accessToken: 'pk.eyJ1IjoiZ2hyaWFubiIsImEiOiJja2lpeHl1cTgwbHh0MnlueGJxNGtnOTlkIn0.Ph91SWa7SUZg6HxyPa4p-Q'
    }).addTo(map);

    map.on('movestart', onStartInteraction);
    map.on('zoomstart', onStartInteraction);
    map.on('moveend', onStopInteraction);
    map.on('zoomend', onStopInteraction);


   function updatePath(pointList) {

        if (pathLine != null) {
            pathLine.remove();
            pathLine = null;
        }

        if(pointList != null) {
            pathLine = L.polyline(pointList).addTo(map);
        }
    }

    function updatePosition(point, centerOnPosition, immediatePan) {

        if (immediatePan) {
            waitBeforeFit = false
        }

        if (positionMarker != null) {
            positionMarker.remove();
            positionMarker = null;
        }
        if (point != null) {       
            positionMarker = L.marker(point, {icon: myIcon}).addTo(map);

            if (centerOnPosition) {
                if (waitBeforeFit) {
                    waitBeforeFit = false
                }
                else {
                    map.panTo(point)
                }
            }
        }
    }

    function setZoom(zoom) {
        map.setZoom(zoom)
    }

    function setView(point, zoom) {
        map.setView(point, zoom)
    }


    function fitBounds() {
        if (pathLine != null) {
            map.fitBounds(pathLine.getBounds())
        }
    }

    function onStartInteraction(e) {
        waitBeforeFit = true;
        isInteracting = true;
    }

    function onStopInteraction(e) {
        isInteracting = false;
    }

</script>